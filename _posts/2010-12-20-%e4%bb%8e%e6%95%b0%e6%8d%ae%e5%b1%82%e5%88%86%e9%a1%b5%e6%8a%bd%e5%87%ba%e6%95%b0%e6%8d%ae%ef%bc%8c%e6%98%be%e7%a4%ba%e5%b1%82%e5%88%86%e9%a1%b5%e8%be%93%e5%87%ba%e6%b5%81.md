---
layout: post
title: 从数据层分页抽出数据，显示层分页输出流
date: 2010-12-20 14:22
author: afeilulu
comments: true
categories: [program]
---
1. 数据层实现
<div id="ctl00_MainContent_ctl26_ctl00_ctl01_">
<div dir="ltr">
<pre>输入参数:PageSize,PageIndex</pre>
<pre>sql = "WITH OrderedOrders AS
    (
    SELECT SalesOrderID, OrderDate,
    ROW_NUMBER() OVER (ORDER BY OrderDate) AS 'RowNumber'
    FROM Sales.SalesOrderHeader 
    ) 
    SELECT * 
    FROM OrderedOrders 
    WHERE RowNumber BETWEEN" + Convert.toint32(PageSize*PageIndex+1)" + " AND " + Convert.toint32(PageSize*(PageIndex+1));</pre>
</div>
</div>
2.表示层

System.Text.StringBuilder output;

System.Text.StringBuilder line;

Response.Clear();

Response.ClearHeaders();

Response.ClearContent();

Response.ContentType = "text/csv";

Response.AppendHeader("Content-disposition", "attachment; filename=test.csv");

//output data by every PageSize

for (int i = 0; i &lt; PageCount; i++)

{

output = new System.Text.StringBuilder();

line = new System.Text.StringBuilder();

dt = ReadData(PageSize, i);

//set header

if (!OutputHeader)

{

OutputHeader = true;

foreach (DataColumn c in dt.Columns)

{

if (line.Length &gt; 0)

{

line.Append(",");

}

line.Append(c.ColumnName);

}

output.AppendLine(line.ToString());

}

//set data

Export2CSV(dt,output,line);

//output

Response.Write(output.ToString());

}

Response.End();
