---
layout: post
title: Cryptography With Java 2 SDK 1.4
date: 2005-02-14 11:45
author: afeilulu
comments: true
categories: [program]
---
<div id="msgcns!4C815953D6B638F4!118" class="bvMsg"><p>By <a href="http://www.informit.com/authors/bio.asp?a=b98623ca-33d5-4ad0-b140-f058c98276f5">Mark Wutka</a>.</p> <p>Encrypting and Decrypting Data </p> <p>Although SSL may handle most of your cryptography needs, you may discover that you need to manually encrypt and decrypt data from time to time. Basically, to encrypt or decrypt data, you need a key and a cipher. You can use the SecretKeyFactory to generate new keys. You can either generate a random key or use an existing array of bytes for the key. In the latter case, you first create a key &quot;spec&quot; from the original bytes and then pass this spec to the key factory.</p> <p>The following code snippet creates a key spec from an array of bytes and then creates a key. The key is a DESede key, which is commonly known as Triple-DES—a more secure version of the original Data Encryption Standard (DES) algorithm. Some of the other available algorithms are DES (the original DES algorithm), Blowfish (a block cipher invented by Bruce Schneier), and PBEWithMD5AndDES (password-based encryption with MD5 digest mode and DES encryption).</p> <p>-------------------------------------------------------------</p> <p><font size="2">// Create an array to hold the key<br />      byte[] encryptKey = &quot;This is a test DESede key&quot;.getBytes();<br /><br />// Create a DESede key spec from the key<br />      DESedeKeySpec spec = new DESedeKeySpec(encryptKey);<br /><br />// Get the secret key factor for generating DESede keys<br />      SecretKeyFactory keyFactory = SecretKeyFactory.getInstance(<br />        &quot;DESede&quot;);<br /><br />// Generate a DESede SecretKey object<br />      SecretKey theKey = keyFactory.generateSecret(spec);</font></p> <p>Once you have a key, you can create a cipher using the Cipher.getInstance method:</p> <p>-------------------------------------------------------------</p> <p><font size="2">Cipher cipher = Cipher.getInstance(&quot;DESede/CBC/PKCS5Padding&quot;);</font></p> <p>In this case, you create a DESede (Triple-DES) cipher with some extra parameters. The second parameter (CBC) controls how you handle successive blocks of data. The simplest method of encrypting multiple blocks is called Electronic Code Book (ECB). When you use ECB, you simply encrypt one block at a time. For each block, you just take the original data, and encrypt it without any additional information. ECB is rather unsafe, however, because someone may be able to learn something about the content of the data by analyzing identical blocks. You can make your data safer by using Chained Block Cipher (CBC) mode. When you encrypt using CBC mode, you combine the data you want to encrypt with a special array of data called an initialization vector (IV) and then encrypt the combined data. For the second block, however, you combine the encrypted first block with the data you want to encrypt (usually with a simple XOR) and then encrypt the combined block. This eliminates repetitive patterns in the encrypted data.</p> <p>Two other modes, Output Feedback (OFB) and Cipher Feedback (CFB), create a stream cipher byte generator out of a block cipher; that is, they make a block cipher behave like a stream cipher.</p> <p>The other parameter—PKCS5Padding, in this case—indicates how to handle incomplete blocks. Remember that a block cipher operates on blocks of a fixed size. By using one of the common padding algorithms, you include the block size in the encrypted data, ensuring that when you decrypt, you get the correct number of bytes back. You can also specify NoPadding if you don't want any padding.</p> <p>When you use CBC mode, you must create an initialization vector before you encrypt or decrypt data. The contents of the IV don't matter much, but you <i>must</i> use the same IV to encrypt and decrypt.</p> <p>-------------------------------------------------------------</p> <p><font size="2">IvParameterSpec IvParameters = new IvParameterSpec( new byte[] &#123; 12, 34, 56, 78, 90, 87, 65, 43 &#125;);</font></p> <p>The following program encrypts a string of data and writes it out to a file:</p> <p>-------------------------------------------------------------</p> <p><font size="2">import java.io.*;<br />import javax.crypto.*;<br />import javax.crypto.spec.*;<br /><br />public class EncryptData<br />&#123;<br />  public static void main(String[] args)<br />  &#123;<br />    try<br />    &#123;<br />// Create an array to hold the key<br />      byte[] encryptKey = &quot;This is a test DESede key&quot;.getBytes();<br /><br />// Create a DESede key spec from the key<br />      DESedeKeySpec spec = new DESedeKeySpec(encryptKey);<br /><br />// Get the secret key factor for generating DESede keys<br />      SecretKeyFactory keyFactory = SecretKeyFactory.getInstance(<br />        &quot;DESede&quot;);<br /><br />// Generate a DESede SecretKey object<br />      SecretKey theKey = keyFactory.generateSecret(spec);<br /><br />// Create a DESede Cipher<br />      Cipher cipher = Cipher.getInstance(&quot;DESede/CBC/PKCS5Padding&quot;);<br /><br />// Create an initialization vector (necessary for CBC mode)<br /><br />      IvParameterSpec IvParameters = new IvParameterSpec(<br />        new byte[] &#123; 12, 34, 56, 78, 90, 87, 65, 43 &#125;);<br /><br />// Initialize the cipher and put it into encrypt mode<br />      cipher.init(Cipher.ENCRYPT_MODE, theKey, IvParameters);<br /><br />      byte[] plaintext =<br />        &quot;This is a sentence that has been encrypted&quot;.getBytes();<br />      <br />// Encrypt the data<br />      byte[] encrypted = cipher.doFinal(plaintext);<br /><br />// Write the data out to a file<br />      FileOutputStream out = new FileOutputStream(&quot;encrypted.dat&quot;);<br />      out.write(encrypted);<br />      out.close();<br />    &#125;<br />    catch (Exception exc)<br />    &#123;<br />      exc.printStackTrace();<br />    &#125;<br />  &#125;<br />&#125;</font></p> <p>The process of encryption and decryption is almost identical from a coding perspective. To decrypt data, you use Cipher.DECRYPT_MODE in the init method for the Cipher object. Beyond that, everything else is the same. The following program decrypts the data that was encrypted by the EncryptData program:</p> <p>-------------------------------------------------------------</p> <p><font size="2">import java.io.*;<br />import javax.crypto.*;<br />import javax.crypto.spec.*;<br />import java.security.*;<br /><br />public class DecryptData<br />&#123;<br />  public static void main(String[] args)<br />  &#123;<br />    try<br />    &#123;<br />// Create an array to hold the key<br />      byte[] encryptKey = &quot;This is a test DESede key&quot;.getBytes();<br /><br />// Create a DESede key spec from the key<br />      DESedeKeySpec spec = new DESedeKeySpec(encryptKey);<br /><br />// Get the secret key factor for generating DESede keys<br />      SecretKeyFactory keyFactory = SecretKeyFactory.getInstance(<br />        &quot;DESede&quot;);<br /><br />// Generate a DESede SecretKey object<br />      SecretKey theKey = keyFactory.generateSecret(spec);<br /><br />// Create a DESede Cipher<br />      Cipher cipher = Cipher.getInstance(&quot;DESede/CBC/PKCS5Padding&quot;);<br /><br />// Create the initialization vector required for CBC mode<br />      IvParameterSpec ivParameters = new IvParameterSpec(<br />        new byte[] &#123; 12, 34, 56, 78, 90, 87, 65, 43 &#125; );<br /><br />// Initialize the cipher and put it in decrypt mode<br />      cipher.init(Cipher.DECRYPT_MODE, theKey, ivParameters);<br /><br />      File encryptedFile = new File(&quot;encrypted.dat&quot;);<br /><br />// Create a byte block to hold the entire encrypted file<br />      byte[] encryptedText = new byte[(int) encryptedFile.length()];<br /><br />      FileInputStream fileIn = new FileInputStream(encryptedFile);<br /><br />// Read the entire encrypted file<br />      fileIn.read(encryptedText);<br /><br />      fileIn.close();<br /><br />// Decrypt the data<br />      byte[] plaintext = cipher.doFinal(encryptedText);<br /><br />      String plaintextStr = new String(plaintext);<br /><br />      System.out.println(&quot;The plaintext is:&quot;);<br />      System.out.println(plaintextStr);<br />    &#125;<br />    catch (Exception exc)<br />    &#123;<br />      exc.printStackTrace();<br />    &#125;<br />  &#125;<br />&#125;</font></p> <p>The cryptography libraries in Java 2 SDK 1.4 are pretty robust, and there are many options available. You can digitally sign or encrypt whole objects. You can also encrypt a stream of data without resorting to SSL. Take a look at the javax.crypto package to get an idea of some of the other available features.</p></div>
