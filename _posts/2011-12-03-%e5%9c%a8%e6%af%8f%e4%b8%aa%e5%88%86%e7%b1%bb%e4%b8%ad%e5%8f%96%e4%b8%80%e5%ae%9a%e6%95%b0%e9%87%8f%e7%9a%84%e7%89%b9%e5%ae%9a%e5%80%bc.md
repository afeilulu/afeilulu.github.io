---
layout: post
title: 在每个分类中取一定数量的特定值
date: 2011-12-03 15:27
author: afeilulu
comments: true
categories: [program]
---
实现目标，比如：
<ol>
	<li>每个分类下最新的10条记录</li>
	<li>每个分类下销售量最高的10件产品</li>
	<li>以及推而广之的更多应用场景</li>
</ol>
实现关键：
<blockquote>ROW_NUMBER()内置函数

语法为 ROW_NUMBER() Over ([Partition by clause] Order by clause)

Over 子句中的Partition by 将结果集分为多个分区，Order by子句将每个分区中的Row_Number进行排序。

也就是说Partition by子句解决“从每个分类中取”的问题；Order by子句解决“特定值”问题

然后以生成的Row_Number为条件进行抽取。</blockquote>
举例：
<blockquote>从下表中取出每个分类中价格最高的5件产品

CREATE TABLE [dbo].[products](
[product_id] [int] NULL,
[category_id] [int] NULL,
[price] [money] NOT NULL
)

SELECT product_id,category_id,price

FROM (select product_id,category_id,price,ROW_NUMBER() OVER (PARTITION BY category_id ORDER BY PRICE DESC) AS row_index FROM products) ATable

WHERE ATable.row_index &lt;=5</blockquote>
在Oracle中相应的内置函数是

RANK() OVER ([PARTITION BY CLAUSE] ORDER BY CLAUSE) 使用方法相同
